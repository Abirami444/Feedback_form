<!doctype html>
<html lang="en">

<head>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restaurant Feedback Form</title>

  <style>
    /* Global styles */
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background: #2c3e50;
      color: #f2f2f2;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100%;
      overflow-y: scroll; /* Allow scrolling */
    }

    h1 {
      text-align: center;
      font-size: 3rem;
      margin-top: 30px;
      color: #e74c3c;
      text-shadow: 0 0 15px rgba(255, 255, 255, 0.3), 0 0 30px rgba(255, 255, 255, 0.6), 0 0 45px rgba(255, 255, 255, 0.8);
      animation: glitter 1s infinite alternate, zoomIn 1s ease-out;
    }

    h2 {
      text-align: center;
      font-size: 1.5rem;
      color: #dcdcdc;
      margin-bottom: 20px;
      animation: glitter 1s infinite alternate, zoomIn 1s ease-out;
    }

    p {
      text-align: center;
      color: #bbb;
      animation: glitter 1s infinite alternate, zoomIn 1s ease-out;
    }

    .feedback-form-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 20px;
      background-color: #34495e;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
      width: 80%;
      max-width: 600px;
      position: relative;
      animation: fadeIn 2s ease-out;
    }

    form {
      width: 100%;
    }

    /* Input and Textarea Fields */
    .form-field {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #34495e;
      font-size: 1rem;
      box-sizing: border-box;
      background: linear-gradient(45deg, #8e44ad, #2980b9);
      color: #fff;
      transition: border 0.3s ease, transform 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .form-field:focus {
      border-color: #e74c3c;
      outline: none;
      transform: scale(1.05);
    }

    .form-button {
      width: 100%;
      padding: 14px;
      background-color: #e74c3c;
      color: white;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .form-button:hover {
      background-color: #c0392b;
      transform: scale(1.05);
    }

    .thank-you-message {
      text-align: center;
      color: #28a745;
      font-size: 1.5rem;
      margin-top: 20px;
      display: none;
      animation: zoomIn 2s ease-out;
    }

    .error-message {
      text-align: center;
      color: #e74c3c;
      font-size: 1rem;
      margin-top: 10px;
      display: none;
    }

    /* Additional styling for labels and options */
    label {
      font-size: 1rem;
      color: #dcdcdc;
      display: block;
      margin: 10px 0 5px;
    }

    .horizontal-options {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }

    /* Glitter and falling animation */
    @keyframes glitter {
      0% {
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.6), 0 0 30px rgba(255, 255, 255, 0.7);
      }
      100% {
        text-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 40px rgba(255, 255, 255, 1), 0 0 60px rgba(255, 255, 255, 1);
      }
    }

    /* Fade-in effect */
    @keyframes fadeIn {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    @keyframes zoomIn {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Falling effect for snowflakes */
    @keyframes snowflakes {
      0% {
        transform: translateY(-100px);
        opacity: 0;
      }
      100% {
        transform: translateY(100vh);
        opacity: 1;
      }
    }

    .snowflake {
      position: absolute;
      top: -10px;
      width: 10px;
      height: 10px;
      background-color: white;
      border-radius: 50%;
      opacity: 0.8;
      animation: snowflakes 5s linear infinite;
      pointer-events: none;
    }

    /* Randomize the falling speed and position of each snowflake */
    .snowflake:nth-child(1) { left: 10%; animation-duration: 4s; animation-delay: 0s; }
    .snowflake:nth-child(2) { left: 20%; animation-duration: 6s; animation-delay: 1s; }
    .snowflake:nth-child(3) { left: 30%; animation-duration: 5s; animation-delay: 2s; }
    .snowflake:nth-child(4) { left: 40%; animation-duration: 4s; animation-delay: 3s; }
    .snowflake:nth-child(5) { left: 50%; animation-duration: 7s; animation-delay: 1.5s; }
    .snowflake:nth-child(6) { left: 60%; animation-duration: 5s; animation-delay: 2.5s; }
    .snowflake:nth-child(7) { left: 70%; animation-duration: 6s; animation-delay: 0.5s; }
    .snowflake:nth-child(8) { left: 80%; animation-duration: 4s; animation-delay: 4s; }
    .snowflake:nth-child(9) { left: 90%; animation-duration: 5s; animation-delay: 3s; }
    .snowflake:nth-child(10) { left: 15%; animation-duration: 4s; animation-delay: 2s; }
    .snowflake:nth-child(11) { left: 25%; animation-duration: 5s; animation-delay: 0.5s; }
    .snowflake:nth-child(12) { left: 35%; animation-duration: 6s; animation-delay: 1s; }
    .snowflake:nth-child(13) { left: 45%; animation-duration: 4s; animation-delay: 2.5s; }
    .snowflake:nth-child(14) { left: 55%; animation-duration: 6s; animation-delay: 3s; }
    .snowflake:nth-child(15) { left: 65%; animation-duration: 5s; animation-delay: 1.5s; }

  </style>
</head>

<body>
  <!-- Falling snowflakes -->
  <div class="snowflakes">
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
    <div class="snowflake"></div>
  </div>

  <h1>Restaurant Feedback Form</h1>
  <h2>We value your feedback</h2>
  <p>Let us know how we did, and help us improve our service!</p>

  <div class="feedback-form-container">
    <form id="feedback-form">
      <label for="name">Name:</label>
      <input type="text" name="name" id="name" class="form-field" placeholder="Enter your name" required>
      
      <label for="email">Email:</label>
      <input type="email" name="email" id="email-field" class="form-field" placeholder="Enter your email" required>
      
      <label for="feedback">Feedback:</label>
      <textarea name="message" id="feedback" class="form-field" placeholder="Your feedback here..." rows="4" required></textarea>

      <label>Overall Rating:</label>
      <div class="horizontal-options">
        <label><input type="radio" name="overall-rating" value="1"> 1</label>
        <label><input type="radio" name="overall-rating" value="2"> 2</label>
        <label><input type="radio" name="overall-rating" value="3"> 3</label>
        <label><input type="radio" name="overall-rating" value="4"> 4</label>
        <label><input type="radio" name="overall-rating" value="5"> 5</label>
      </div>

      <label>Cleanliness:</label>
      <div class="horizontal-options">
        <label><input type="radio" name="cleanliness" value="1"> 1</label>
        <label><input type="radio" name="cleanliness" value="2"> 2</label>
        <label><input type="radio" name="cleanliness" value="3"> 3</label>
        <label><input type="radio" name="cleanliness" value="4"> 4</label>
        <label><input type="radio" name="cleanliness" value="5"> 5</label>
      </div>

      <label>Taste:</label>
      <div class="horizontal-options">
        <label><input type="radio" name="taste" value="1"> 1</label>
        <label><input type="radio" name="taste" value="2"> 2</label>
        <label><input type="radio" name="taste" value="3"> 3</label>
        <label><input type="radio" name="taste" value="4"> 4</label>
        <label><input type="radio" name="taste" value="5"> 5</label>
      </div>

      <label>Service:</label>
      <div class="horizontal-options">
        <label><input type="radio" name="service" value="1"> 1</label>
        <label><input type="radio" name="service" value="2"> 2</label>
        <label><input type="radio" name="service" value="3"> 3</label>
        <label><input type="radio" name="service" value="4"> 4</label>
        <label><input type="radio" name="service" value="5"> 5</label>
      </div>

      <div class="g-recaptcha" data-sitekey="6LegwHYqAAAAAInkzklpRSA3G_kEEYQwEMlXJTl_"></div>

      <button type="submit" class="form-button">Submit</button>
    </form>
    <div class="thank-you-message" id="thank-you-message">Thank you for your feedback!</div>
    <div class="error-message" id="error-message">Please complete all fields and verify captcha.</div>
  </div>

  <script>
    // Function to get query parameters from the URL
    function getQueryParams() {
      const urlParams = new URLSearchParams(window.location.search);
      const email = urlParams.get('email');
      if (email) {
        document.getElementById('email-field').value = decodeURIComponent(email); // Populate the feedback form with the email
      }
    }
  
    // Fixing the aria-hidden issue
    window.onload = function() {
      const recaptchaDiv = document.querySelector('.g-recaptcha');
      if (recaptchaDiv) {
        // Check if the reCAPTCHA div exists
        const iframe = recaptchaDiv.querySelector('iframe');
        if (iframe) {
          // Set aria-hidden="false" to make reCAPTCHA accessible
          iframe.removeAttribute('aria-hidden');
        }
      }
  
      // Populate the email field on page load
      getQueryParams();
    };
  
    // Handle form submission
    document.getElementById("feedback-form").addEventListener("submit", function (e) {
      e.preventDefault(); // Prevent default form submission
  
      // Collect all the data from the form
      const formData = new FormData(this);
      const feedbackData = {
        email: document.getElementById('email-field').value,
        name: formData.get('name'),
        overallRating: formData.get('overall-rating'),
        cleanlinessRating: formData.get('cleanliness'),
        tasteRating: formData.get('taste'),
        serviceRating: formData.get('service'),
        message: formData.get('message'),
        recaptchaResponse: grecaptcha.getResponse() // Get reCAPTCHA response
      };
  
      // Validate the reCAPTCHA response
      if (!feedbackData.recaptchaResponse) {
        alert("Please complete the reCAPTCHA.");
        return;
      }
  
      // Validate required fields
      if (!feedbackData.name || !feedbackData.overallRating || !feedbackData.cleanlinessRating || 
          !feedbackData.tasteRating || !feedbackData.serviceRating || !feedbackData.message) {
        alert("Please fill out all required fields.");
        return;
      }
  
      const submitButton = document.querySelector('.form-button');
      const thankYouMessage = document.getElementById('thank-you-message');
      const errorMessage = document.getElementById('error-message');
  
      submitButton.disabled = true; // Disable the button to prevent multiple submissions
      errorMessage.style.display = 'none'; // Hide error message
  
      // Submit feedback to the backend
      fetch('/api/feedback', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(feedbackData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          thankYouMessage.style.display = 'block'; // Show thank-you message
          thankYouMessage.classList.add('zoomIn');
          setTimeout(() => {
            window.location.href = '/'; // Redirect to home page or another page after success
          }, 3000);
        } else {
          errorMessage.style.display = 'block'; // Show error message
          alert(data.message || 'Something went wrong.');
        }
      })
      .catch(error => {
        console.error('Error submitting feedback:', error);
        errorMessage.style.display = 'block'; // Show error message
      })
      .finally(() => {
        submitButton.disabled = false; // Re-enable the button
      });
    });
  </script>

</body>

</html>
